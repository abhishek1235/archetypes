define("launchpad/lib/transactions/balance-update",["angular","jquery","launchpad/lib/transactions/transactions-module"],function(e,m,k){k.directive("lpBalanceUpdate",function(){return{restrict:"A",require:"ngModel",link:function(e,d,c,b){d.addClass("lp-amount");e.$watch(function(){return b.$modelValue},function(a,b){a.id===b.id&&(1===a.delta?(d.addClass("lp-increase-amount"),setTimeout(function(){d.removeClass("lp-increase-amount")},1E3)):-1===a.delta&&(d.addClass("lp-decrease-amount"),setTimeout(function(){d.removeClass("lp-decrease-amount")},
1E3)),a.delta=0)})}}})});define("launchpad/lib/transactions/currency-model",["jquery","angular","launchpad/lib/common/util","launchpad/lib/transactions/transactions-module"],function(e,m,k,g){g.factory("CurrencyModel",["httpService",function(d){var c=function(b){this.groups={defaultCurrency:"aDefault",preferredCurrencies:"bPreferred",rest:"cOther"};this.disableExtraCurrencies=b.disableExtraCurrencies;this.defaultCurrencyService=d.getInstance({endpoint:b.defaultCurrencyEndpoint});this.currencyListService=d.getInstance({endpoint:b.currencyListEndpoint});
this.orderedCurrencies=[]};c.prototype.loadDefaultCurrency=function(){var b=this,a=b.defaultCurrencyService.read();a.error(function(){b.error="currencyServiceError"});return a};c.prototype.configureDefaultCurrency=function(b){this.selected=this.defaultCurrency={currency_code:b.currency_code,exchange_rate:1,group:this.groups.defaultCurrency};this.orderedCurrencies.push(this.defaultCurrency)};c.prototype.loadOtherCurrencies=function(){var b=this;b.currencyListService.endpoint+="?currency\x3d"+b.defaultCurrency.currency_code;
var a=b.currencyListService.read();a.success(function(a){a&&b.sortCurrencies(a)});a.error(function(){b.error="currencyServiceError"});return a};c.prototype.sortCurrencies=function(b){for(var a=0;a<b.preferred.length;a++)b.preferred[a].group=this.groups.preferredCurrencies;this.orderedCurrencies.push.apply(this.orderedCurrencies,b.preferred);if(!this.disableExtraCurrencies){for(a=0;a<b.rest.length;a++)b.rest[a].group=this.groups.rest;b.rest.sort(function(a,b){var c=a.currency_code.toLowerCase(),d=
b.currency_code.toLowerCase();return c<d?-1:c>d?1:0});this.orderedCurrencies.push.apply(this.orderedCurrencies,b.rest)}};c.prototype.findCurrency=function(b){return this.orderedCurrencies.filter(function(a){return a.currency_code===b})[0]};c.prototype.selectCurrency=function(b){this.selected=this.findCurrency(b)};return{getInstance:function(b){return new c(b)}}}])});define("launchpad/lib/transactions/transactions-chart-model",["jquery","angular","launchpad/lib/common/util","launchpad/lib/transactions/transactions-module"],function(e,m,k,g){g.factory("TransactionsChartModel",["$rootScope","httpService",function(d,c){var b=function(a){this.transactionsChartModel=c.getInstance({endpoint:a.transactionsChartEndpoint,urlVars:{accountId:a.accountId}});this.chartData=null;this.error=!1};b.prototype.load=function(a){var b=this;a=b.transactionsChartModel.read(a).success(function(a){b.chartData=
a});a.error(function(a){a.errors&&(b.error=a.errors[0].code)});return a};return{getInstance:function(a){return new b(a)}}}])});/*
 Backbase B.V, 2013
 @module transactions-model
 @exports TransactionsModel
*/
define("launchpad/lib/transactions/transactions-model",["jquery","angular","launchpad/lib/common/util","launchpad/lib/transactions/transactions-module"],function(e,m,k,g){g.factory("TransactionsModel",["httpService",function(d){var c={QUERY:"query",FROM_DATE:"fromDate",TO_DATE:"toDate",FROM_AMOUNT:"fromAmount",TO_AMOUNT:"toAmount",CONTACT:"contact"},b=function(a){this.transactionsEndpoint=a.transactionsEndpoint;this.transactionDetailsEndpoint=a.transactionDetailsEndpoint;this.locale=a.locale;this.pageSize=
a.pageSize||20;this.sort="-bookingDateTime";this.transactions=[];this.moreAvailable=!0;this.messages={};this.from=1;this.account=this.errorCode=null};b.prototype.clearTransactionsList=function(){this.transactions=[];this.moreAvailable=!0;this.from=1};b.prototype.setFilters=function(a){this.filters=a};b.prototype.clearFilters=function(){this.filters={}};b.prototype.loadTransactions=function(a){this.clearTransactionsList();this.account=a;return this.loadMoreTransactions()};b.prototype.loadMoreTransactions=
function(){var a=this;this.loading=!0;if(!this.account)throw Error("No account specified");var b=d.getInstance({endpoint:this.transactionsEndpoint,urlVars:{accountId:this.account.id}}),f={f:this.from,l:this.pageSize};this.filters&&(this.filters.query?(f.a="search",f.q=this.filters[c.QUERY]):this.filters[c.FROM_DATE]&&this.filters[c.TO_DATE]?(f.df=this.filters[c.FROM_DATE],f.dt=this.filters[c.TO_DATE]):this.filters[c.FROM_AMOUNT]&&this.filters[c.TO_AMOUNT]?(f.af=this.filters[c.FROM_AMOUNT],f.at=this.filters[c.TO_AMOUNT]):
this.filters[c.CONTACT]&&(f.ca=this.filters[c.CONTACT]));f.sort=this.sort;b=b.read(f);b.success(function(b){if(null===b||"null"===b)b=[];a.from+=a.pageSize;(b=a.preprocessTransactions(b))&&b.length<a.pageSize&&(a.moreAvailable=!1);a.transactions.length=f.f-1;a.transactions=a.transactions.concat(b)});b.error(function(b){a.errorCode=b.errorCode||500});b["finally"](function(){a.loading=!1});return b};b.prototype.preprocessTransactions=function(a){a&&(a=a.map(function(b,c){var d=a[c-1]?new Date(a[c-1].bookingDateTime):
new Date((new Date).getTime()+864E5),e=new Date(b.bookingDateTime);b.newDate=d.getDate()!==e.getDate()||d.getMonth()!==e.getMonth()||d.getFullYear()!==e.getFullYear();b.details||(b.details=null);"DBIT"===b.creditDebitIndicator&&(b.transactionAmount*=-1);return b}));return a};b.prototype.loadTransactionDetails=function(a){var b=this;if(!a.details||e.isEmptyObject(a.details)){a.loading=!0;this.transactionDetailsService=d.getInstance({endpoint:this.transactionDetailsEndpoint,urlVars:{transactionId:a.id,
accountId:this.account.id}});var c=this.transactionDetailsService.read();c.success(function(c){a.details=b.preprocessTransactionDetails(c,a)});c.error(function(b){a.errorCode=b.errorCode||500});c["finally"](function(){a.loading=!1;a.displayDetails=a.displayDetails?!1:!0});return c}a.displayDetails=a.displayDetails?!1:!0};b.prototype.preprocessTransactionDetails=function(a,b){var c=[],d=[],e=["location"],g=["address","merchantType","bookingDateTime"],k=["transactionId"];if(a){if("object"===typeof a.location){var h=
a.location.latitude+","+a.location.longitude,h=["size\x3d160x90","center\x3d"+h,"zoom\x3d12","format\x3djpg","sensor\x3dfalse","markers\x3d"+encodeURIComponent("size:med|color:red|")+h];a.location.mapUrl="http://maps.googleapis.com/maps/api/staticmap?"+h.join("\x26")}a.bookingDateTime=b.bookingDateTime;for(var l in a)a.hasOwnProperty(l)&&0>e.indexOf(l)&&(h={name:l,value:a[l],longValue:-1<k.indexOf(l)},-1<g.indexOf(l)?c.push(h):d.push(h));a.special=c;a.custom=d}return a};b.prototype.allowMoreResults=
function(){return!this.loading&&this.moreAvailable&&!this.errorCode};b.prototype.noTransactionsFound=function(){return!this.loading&&0===this.transactions.length&&!this.errorCode};b.prototype.isSearching=function(){if(this.filters)for(var a in this.filters)if(this.filters.hasOwnProperty(a))return!0;return!1};return{getInstance:function(a){return new b(a)},availableFilters:c}}])});define("launchpad/lib/transactions/transactions-module",["angular","launchpad/lib/common"],function(e){return e.module("transactions",["common"])});define(["launchpad/lib/transactions/transactions-module","launchpad/lib/transactions/transactions-model","launchpad/lib/transactions/transactions-chart-model","launchpad/lib/transactions/balance-update","launchpad/lib/transactions/currency-model"],function(e){return e});
//# sourceMappingURL=transactions.js.map