/*
 Backbase B.V, 2013

 @example
 lp.util.isSmartphone();
*/
(function(f,b){var d={},h=f.lp;d.parseBoolean=function(b){return"boolean"===typeof b&&b||"string"===typeof b&&/\s*true\s*/i.test(b)||"number"===typeof b&&0!==b};var n={};d.setPageBackground=function(e){var a=b("#main"),c=n[e];c||(c=b("\x3cdiv class\x3dlp-full-bg /\x3e").css("background-image","url("+e+")"),a.prepend(c),n[e]=c);e=a.children(".lp-full-bg").not(c);e.fadeOut(1E3);c.fadeIn(0===e.length?0:1E3)};d.showBackdrop=function(e){e=e||200;b("#lp-page-backdrop").fadeTo(e,0.5)};d.hideBackdrop=function(e){e=
e||200;b("#lp-page-backdrop").fadeOut(e)};d.isDesignMode=function(){return d.parseBoolean(bd.designMode)};d.getContextPath=function(){return"undefined"!==typeof b$?b$.portal.config.serverRoot:""};d.getServicesPath=function(){return f.lp.servicesPath?f.lp.servicesPath:d.getContextPath()};d.isDesktop=function(){return!d.isTablet&&!d.isSmartphone()};d.isTablet=function(){return b("html").hasClass("tablet")};d.isSmartphone=function(){return b("html").hasClass("smartphone")};d.getWidgetFromNode=function(e){return b(e).closest(".bp-widget")[0].viewController};
d.applyScope=function(b){b.$$phase||b.$apply()};d.replaceUrlVars=function(b,a){if("string"===typeof b)for(var c in a)a.hasOwnProperty(c)&&(b=b.replace(RegExp("\\$\\("+c+"\\)","g"),a[c]));return b};d.findMatchingChildrenByTag=function(b,a){var c=[];b.childNodes&&(c=b.childNodes.filter(function(b){return 0<b.model.tags.filter(function(b){return"behavior"===b.type&&b.value===a}).length}));return c};var l={"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#39;","/":"\x26#x2F;"};
d.escapeHtml=function(b){return"string"===typeof b?b.replace(/[&<>"'\/]/g,function(a){return l[a]}):b};d.stripHtml=function(b){return"string"===typeof b?b.replace(/[&<>"'\/]/g,""):b};d.generateUUID=function(){var b=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=(b+16*Math.random())%16|0;b=Math.floor(b/16);return("x"===a?c:c&7|8).toString(16)})};d.setMasterPreference=function(b,a){var c=b$.portal.portalView.getElementsByTagName("page")[0];c.setPreference(b,
a);c.model.save();c=h.restClient.makePutPageRequest({contextPath:b$.portal.config.serverRoot,name:c.model.extendedItemName||c.model.name,contextItemName:c.model.contextItemName,properties:[{name:b,type:"string",value:a}]});return h.restClient.sendRequest(c.url,c.method,c.body)};d.extractInitials=function(b){var a="";b=b.split(" ");for(var c=0;c<b.length;c++)a+=b[c].substr(0,1);return a=a.toUpperCase()};d.getColorFromInitials=function(b){b=b.charCodeAt(0)-64;var a=b+120;return[[a,210,210],[a,a,210],
[210,a,a],[a,210,a],[210,a,210]][Math.floor((b-1)/25*4+1-1)]};d.defaultProfileImage="/portalserver/static/launchpad/widgets/addressbook/media/address_placeholder.png";d.getDefaultProfileImage=function(e,a,c,g){var k=document.createElement("canvas");if(!k.getContext||!k.getContext("2d"))return d.defaultProfileImage;e=d.extractInitials(e);g=g||d.getColorFromInitials(e);k.setAttribute("width",a);k.setAttribute("height",c);var m=k.getContext("2d");m.fillStyle=b.isArray(g)?"rgb("+g.join(",")+")":g;m.fillRect(0,
0,a,c);m.fillStyle="rgb(250,250,250)";switch(e.length){case 1:g=0.6;break;case 2:g=0.5;break;case 3:g=0.45;break;default:g=0.3}g=parseInt(g*c,10);var f=Math.floor(0.15*c);m.font=g+"px Proxima Regular, Helvetica Nueue, Helvetica, Arial, sans-serif";m.textAlign="right";m.fillText(e,a-3,c-f);return k.toDataURL("image/png")};d.getSelectionPositionOfInput=function(b,a){var c=[];a||(a=function(a){return a});if("selectionStart"in b)c=[a(b.selectionStart),a(b.selectionEnd)];else{var g=document.selection.createRange();
if(g&&g.parentElement()===b){var k=b.createTextRange();k.moveToBookmark(g.getBookmark());c[0]=a(k.moveStart("character",-b.value.length));c[1]=a(k.moveEnd("character",-b.value.length))}}return c};d.getNewCaretPosition=function(b,a,c,g){var k=a[0];c=a[1]-a[0]+c;0>=c&&(c=1);b.value.length||(a=[0,0]);return k=a[0]===a[1]?g?0===a[0]?0:a[0]-1:a[0]+c:g?a[0]:a[0]+c};d.setCaretPositionOfInput=function(e,a,c,g){if("setSelectionRange"in e)e.setSelectionRange(a,a);else{var k=e.createTextRange();k.collapse(!0);
k.moveEnd("character",a);k.moveStart("character",a);k.select()}c&&g&&(c?g.text(c.substr(0,a)):g.text(""),a=g.width()-b(e).width()/2,e.scrollLeft=a)};d.validateISO7064Checksum=function(b){var a=function(a){a=a.split("");for(var b=0;b<a.length;b++)/[A-Z]/.test(a[b])&&(a[b]=a[b].charCodeAt(0)-55);return a.join("")},c=function(a){a=parseInt(a,10)%97;a=a.toString();return 1===a.length?"0"+a:a};if(b){b=b.substr(4)+b.substr(0,4);for(b=a(b);2<b.length;)b=c(b.substr(0,9))+b.substr(9);if(1===parseInt(b,10))return!0}return!1};
f.lp=f.lp||{};f.lp.util=d})(window,jQuery);define("launchpad/lib/common/rest-services",["jquery","angular","launchpad/lib/common/util","launchpad/lib/common/common-module"],function(f,b,d,h){h.constant("httpServicesConfig",{defaultConfig:{cacheTimeout:1E3,xhrTimeout:5E3}});h.factory("httpService",["$http","$q","$timeout","httpServicesConfig",function(h,l,e,a){var c=function(c){b.extend(this,a.defaultConfig,c)};c.prototype.read=function(a,b){var c=this,d=g(this.endpoint,a),e;b||(e=k(d));e||(e=p(this.endpoint,"GET",{},a).success(function(a){m(d,
a,c.cacheTimeout)}));return e};var g=function(a,b){b=b?"."+JSON.stringify(b):"";return"launchpad.services/"+a+b},k=function(a){a=sessionStorage.getItem(a);var b=null;a&&-1<a.timestamp&&(a=JSON.parse(a),b=r(a.data));return b},m=function(a,b,c){sessionStorage.setItem(a,JSON.stringify({timestamp:(new Date).getTime(),data:b}));e(function(){sessionStorage.removeItem(a)},c)};c.prototype.create=function(a){a=b.extend({},{method:"POST"},a);return p(this.endpoint,a.method,a.data)};c.prototype.update=function(a){a=
b.extend({},{method:"PUT"},a);return p(this.endpoint,a.method,a.data)};c.prototype.del=function(a){a=b.extend({},{method:"DELETE"},a);return p(this.endpoint,a.method,a.data)};var p=function(a,c,d,g,k){"GET"===c&&f.browser.msie&&9>=parseFloat(f.browser.version)&&(g=b.extend(g||{},{dt:(new Date).getTime()}));a={method:c,url:a,params:g,data:f.param(d||{}),cache:!1,headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded;"},timeout:k};return h(a)},r=function(a){var b=l.defer(),
c=b.promise;c.success=function(a){c.then(function(b){a(b)},null);return c};c.error=function(a){c.then(null,function(b){a(b)});return c};c.always=function(a){c.then(null,null,function(b){a(b)});return c};e(function(){b.resolve(a)});return c},q={};return{getInstance:function(a){if(!a.endpoint||"string"!==typeof a.endpoint)throw Error("You must specify an endpoint in your service config");q[a.endpoint]||(a.urlVars=a.urlVars||{},a.urlVars.contextRoot=a.urlVars.contextRoot||d.getContextPath(),a.urlVars.contextPath=
a.urlVars.contextPath||d.getServicesPath(),a.urlVars.servicesPath=a.urlVars.servicesPath||d.getServicesPath(),a.endpoint=d.replaceUrlVars(a.endpoint,a.urlVars),q[a.endpoint]=new c(a));return q[a.endpoint]},resolvePromise:r}}])});(function(f){var b={_defaultContextPath:"/portalserver",_defaultServer:"",http:{GET:"get",POST:"post",PUT:"put",DELETE:"delete"},item:{PORTAL:"portal",PAGE:"page",CONTAINER:"container",WIDGET:"widget",LINK:"link"},tmpl:{PROPERTIES:'\x3cproperties\x3e\n{{#properties}}\x3cproperty name\x3d"{{name}}"\x3e\n\x3cvalue type\x3d"{{type}}"\x3e{{value}}\x3c/value\x3e\n\x3c/property\x3e\n{{/properties}}\x3c/properties\x3e\n',ITEM_INNER:"\x3cname\x3e{{name}}\x3c/name\x3e\n\x3ccontextItemName\x3e{{contextItemName}}\x3c/contextItemName\x3e\n{{#parentItemName}}\x3cparentItemName\x3e{{parentItemName}}\x3c/parentItemName\x3e\n{{/parentItemName}}{{#extendedItemName}}\x3cextendedItemName\x3e{{extendedItemName}}\x3c/extendedItemName\x3e\n{{/extendedItemName}}"}};
b.tmpl.PAGE="\x3cpage\x3e\n"+b.tmpl.ITEM_INNER+b.tmpl.PROPERTIES+"\x3c/page\x3e";b.tmpl.CONTAINER="\x3ccontainer\x3e\n"+b.tmpl.ITEM_INNER+b.tmpl.PROPERTIES+"\x3c/container\x3e";b.tmpl.WIDGET="\x3cwidget\x3e\n"+b.tmpl.ITEM_INNER+b.tmpl.PROPERTIES+"\x3c/widget\x3e";b.tmpl.LINK="\x3clink\x3e\n"+b.tmpl.ITEM_INNER+b.tmpl.PROPERTIES+"\x3c/link\x3e";b.defaultData={PAGE:{properties:[{name:"title",type:"string",value:"New container"},{name:"order",type:"double",value:"0"}]},CONTAINER:{properties:[{name:"title",
type:"string",value:"New container"},{name:"order",type:"double",value:"0"}]},WIDGET:{properties:[{name:"TemplateName",type:"string",value:"Standard_Widget"},{name:"widgetChrome",type:"string",value:"$(contextRoot)/static/launchpad/chromes/default/chrome-default.html"},{name:"title",type:"string",value:"New widget"},{name:"order",type:"double",value:"0"}]},LINK:{properties:[{name:"title",type:"string",value:"New container"},{name:"order",type:"double",value:"0"}]}};b.makeGetCatalogRequest=function(a){var c=
a.modifiers?"?"+e(a.modifiers):"";return{url:b.makeRestCatalogUrl(a.server,a.contextPath,a.contextItemName,c),method:b.http.GET}};b.makePutCatalogRequest=function(a){var c=null;a.itemType===b.item.WIDGET?c=b.tmpl.WIDGET:a.itemType===b.item.CONTAINER&&(c=b.tmpl.CONTAINER);var g=a.modifiers?"?"+e(a.modifiers):"",c="\x3ccatalog\x3e\n"+b.getRequestBody(c,a)+"\n\x3c/catalog\x3e";return{url:b.makeRestCatalogUrl(a.server,a.contextPath,a.contextItemName,g),method:b.http.PUT,body:c}};b.makeGetPortalRequest=
function(a){var c="object"===typeof a.modifiers?"?"+e(a.modifiers):"";return{url:b.makeRestItemUrl(a.server,a.contextPath,a.contextItemName,null,null,c),method:b.http.GET}};b.makeGetPageRequest=function(a){h(a);return{url:b.makeRestItemUrl(a.server,a.contextPath,a.contextItemName,"pages",a.name),method:b.http.GET}};b.makeGetContainerRequest=function(a){h(a);return{url:b.makeRestItemUrl(a.server,a.contextPath,a.contextItemName,"containers",a.name),method:b.http.GET}};b.makeGetWidgetRequest=function(a){h(a);
return{url:b.makeRestItemUrl(a.server,a.contextPath,a.contextItemName,"widgets",a.name),method:b.http.GET}};b.makeGetLinksRequest=function(a){return{url:b.makeRestItemUrl(a.server,a.contextPath,a.contextItemName,"links",a.name,a.query),method:b.http.GET}};b.makePostPageRequest=function(a){h(a);d(a,"parentItemName");n(a,"TemplateName");a=f.extend(!0,{},b.defaultData.PAGE,a);a.properties=l(b.defaultData.PAGE.properties,a.properties);return{url:b.makeRestItemUrl(a.server,a.contextPath,a.contextItemName,
"pages"),method:b.http.POST,body:b.getRequestBody(b.tmpl.PAGE,a)}};b.makePostContainerRequest=function(a){h(a);d(a,"parentItemName");n(a,"TemplateName");a=f.extend(!0,{},b.defaultData.CONTAINER,a);a.properties=l(b.defaultData.CONTAINER.properties,a.properties);return{url:b.makeRestItemUrl(a.server,a.contextPath,a.contextItemName,"containers"),method:b.http.POST,body:b.getRequestBody(b.tmpl.CONTAINER,a)}};b.makePostWidgetRequest=function(a){h(a);d(a,"parentItemName");n(a,"src");a=f.extend(!0,{},b.defaultData.WIDGET,
a);a.properties=l(b.defaultData.WIDGET.properties,a.properties);return{url:b.makeRestItemUrl(a.server,a.contextPath,a.contextItemName,"widgets"),method:b.http.POST,body:b.getRequestBody(b.tmpl.WIDGET,a)}};b.makePutPageRequest=function(a){h(a);return{url:b.makeRestItemUrl(a.server,a.contextPath,a.contextItemName,"pages",a.name),method:b.http.PUT,body:b.getRequestBody(b.tmpl.PAGE,a)}};b.makePutContainerRequest=function(a){h(a);return{url:b.makeRestItemUrl(a.server,a.contextPath,a.contextItemName,"containers",
a.name),method:b.http.PUT,body:b.getRequestBody(b.tmpl.CONTAINER,a)}};b.makePutWidgetRequest=function(a){h(a);return{url:b.makeRestItemUrl(a.server,a.contextPath,a.contextItemName,"widgets",a.name),method:b.http.PUT,body:b.getRequestBody(b.tmpl.WIDGET,a)}};b.makeDeletePageRequest=function(a){h(a);return{url:b.makeRestItemUrl(a.server,a.contextPath,a.contextItemName,"pages",a.name),method:b.http.DELETE}};b.makeDeleteContainerRequest=function(a){h(a);return{url:b.makeRestItemUrl(a.server,a.contextPath,
a.contextItemName,"containers",a.name),method:b.http.DELETE}};b.makeDeleteWidgetRequest=function(a){h(a);return{url:b.makeRestItemUrl(a.server,a.contextPath,a.contextItemName,"widgets",a.name),method:b.http.DELETE}};b.getRequestBody=function(a,b){return(Mustache.render||Mustache.to_html).call(null,a,b)};b.sendRequest=function(a,b,g,d){a=f.ajax({type:b,url:a,data:g,processData:!1,contentType:"application/xml; charset\x3dUTF-8"});"function"===typeof d&&a.done(function(a){d(a)});return a};b.setDefaultContextPath=
function(a){b._defaultContextPath=a};b.setDefaultServer=function(a){b._defaultServer=a};b.makeRestItemUrl=function(a,b,d,k,e,f){e=e?"/"+e:"";a=(a||"")+b+"/portals/"+d;k&&e?a+="/"+k+e:k&&(a+="/"+k);return a+=".xml"+(f||"")};b.makeItemUrl=function(a,c,d,e,f,h){return b.makeRestItemUrl(a,c,d,e,f,h).replace(/\.xml/,"")};b.makeRestCatalogUrl=function(a,b,d,e){a=a||"";e=e||"";return d?a+b+"/portals/"+d+"/catalog.xml"+e:a+b+"/catalog.xml"+e};var d=function(a,b){if(!a[b]||"string"!==typeof a[b])throw Error("Missing param ["+
b+"]");},h=function(a){d(a,"name");d(a,"contextItemName");a.server=a.server||b._defaultServer;a.contextPath=a.contextPath||b._defaultContextPath},n=function(a,b){var d=null;if(a.properties&&f.isArray(a.properties)){for(var e=!1,h=0;h<a.properties.length&&!e;h++)a.properties[h].name===b&&(e=!0);e||(d=b+" was not set as a property for this item")}else d="No properties are set or they are not an array";if(d)throw Error(d);},l=function(a,b){var d=0<b.length?b.slice(0):[],e,f,h,l;for(e=0;e<a.length;e++){h=
a[e].name;l=!1;for(f=0;f<d.length&&!l;f++)d[f].name===h&&(l=!0);l||d.push(a[e])}return d},e=function(a){var b=[];a.f&&f.isPlainObject(a.f)&&(a.f.opererator=a.f.operator||"eq",b.push("f\x3d"+a.f.name+"("+a.f.operator+")"+encodeURIComponent(a.f.value)));a.ps&&f.isNumeric(a.ps)&&b.push("ps\x3d"+a.ps);a.of&&f.isNumeric(a.of)&&b.push("of\x3d"+a.of);a.s&&f.isPlainObject(a.s)&&b.push("s\x3d"+a.s.name+"("+a.s.value+")");a.pc&&b.push("pc\x3d"+a.pc);return b.join("\x26")};window.lp=window.lp||{};window.lp.restClient=
b})(jQuery);define("launchpad/lib/common/common-module",["angular"],function(f){return f.module("common",[])});define(["launchpad/lib/common/common-module","launchpad/lib/common/rest-services","launchpad/lib/common/rest-client"],function(f){return f});
//# sourceMappingURL=common.js.map